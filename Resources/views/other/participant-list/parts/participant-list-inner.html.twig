{% set contact = participant.contact(false)|default %}
{% set event = participant.event(false)|default %}
{% set regRange = participant.regRange|default %}
{% set appUser = contact.appUser|default %}

<tbody>
<tr {{ participant.deletedAt ? 'style="background-color:rgba(255,0,0,.3);"' : '' }}>
    <td style="border: 1px solid grey; padding: .3em .6em; text-align: right;">
        {% if participant.deletedAt|default %}
            <div class="block small" style="color:red;">
                <strong>❌</strong>&nbsp;smazáno {{ participant.deletedAt|date("j. n. Y, H:i") }}
            </div>
        {% endif %}
        <div class="block small">
            <strong class="badge badge-primary font-1em">{{ participant.id }}</strong> {{ participant.createdAt|date("j. n. Y, H:i") }}
        </div>
        {% if appUser and appUser.activated %}
            <div class="block small" style="color:green;">
                <strong>✔</strong>&nbsp;{{ appUser.activated|date("j. n. Y, H:i") }}
            </div>
        {% else %}
            <div class="block small" style="color:red;">
                <strong>❌</strong>&nbsp;neověřeno
            </div>
        {% endif %}
        <div class="block small">
            ☎ <a href="call:{{ contact.phone|default }}" target="_blank">{{ contact.phone|default }}</a>
        </div>
        <div class="block small">
            ✉ <a href="mailto:{{ contact.email|default }}" target="_blank">{{ contact.email|default }}</a>
        </div>
    </td>
    <td style="border: 1px solid grey; padding: .3em .6em;">
        <ul>
            {% for participantContact in participant.participantContacts(false, false) %}
                {% set listGenderIcon = "👤" %}
                {% if 'male' == participantContact.contact.gender|default %}
                    {% set listGenderIcon = "👨" %}
                {% elseif 'female' == participantContact.contact.gender|default %}
                    {% set listGenderIcon = "👩" %}
                {% endif %}
                <li style="list-style-type: '{{ listGenderIcon }}' {{ participantContact.active|default ? '' : 'text-decoration:line-through;' }}">
                    <strong>{{ participantContact.contact.name|default }}</strong>
                </li>
            {% endfor %}
            {% for participantRange in participant.participantRanges(false, false) %}
                <li style="list-style-type: '📅'; {{ participantRange.active|default ? '' : 'text-decoration:line-through;' }}">
                    <span class="block small"><strong>{{ participantRange.event.shortName|default }}</strong></span>
                </li>
                <li style="list-style-type: '🎫'; {{ participantRange.active|default ? '' : 'text-decoration:line-through;' }}">
                    <span class="block small"><strong>{{ participantRange.range.shortName|default }}</strong></span>
                </li>
            {% endfor %}
            {% for note in participant.notes|filter(note => note.textValue|default|length > 0) %}
                <li style="list-style-type: '📝'; {{ note.deletedAt|default ? 'text-decoration:line-through;' : '' }}">
                    <span class="block small">{{ note.textValue }}</span>
                </li>
            {% endfor %}
        </ul>
    </td>
    <td style="border: 1px solid grey; padding: .3em .6em; font-size: small;">
        <div>
            {% for participantFlagGroup in participant.flagGroups|filter(participantFlagGroup => participantFlagGroup.participantFlags|length > 0) %}
                <div style="{{ participantFlagGroup.deletedAt ? 'text-decoration:line-through;' : '' }}">
                    {% for index, participantFlag in participantFlagGroup.participantFlags %}
                        {% set badgeColorString = participantFlag.flag.color|default
                            ? 'background-color:'~participantFlag.flag.color~';color:'~participantFlag.flag.foregroundColor~';'
                            : '' %}
                        {% set badgeColorString = participantFlag.deletedAt ? 'background-color:lightgrey;color:darkgrey;' : badgeColorString %}
                        <div class="badge badge-info smaller" data-toggle="tooltip" data-html="true"
                             style="{{ badgeColorString }} {{ participantFlag.deletedAt ? 'text-decoration:line-through;' : '' }}"
                             title="Příznak: {{ participantFlag.flag.name|default }}<br>
                             ID přiřazení {{ participantFlag.id }}<br>
                             ID rozsahu {{ participantFlag.flagRange.id }}<br>
                             {{ participantFlag.deletedAt ? 'SMAZÁN: '~participantFlag.deletedAt|date("j. n. Y H:i") : '' }}<br>
                             Skupina: {{ participantFlagGroup.flagGroupRange.name }}<br>
                             ID přiřazení skupiny {{ participantFlagGroup.id }}<br>
                             ID rozsahu skupiny {{ participantFlagGroup.flagGroupRange.id }}<br>
                             {{ participantFlagGroup.deletedAt ? 'SMAZÁNA: '~participantFlagGroup.deletedAt|date("j. n. Y H:i") : '' }}">
                            {{ participantFlag.flag.shortName|default }}
                            {% if participantFlag.flagRange.price|default(0) != 0 %}
                                <div class="badge badge-danger" style="{{ participantFlag.deletedAt ? 'text-decoration:line-through;' : '' }}">
                                    <strong>
                                        {{ participantFlag.flagRange.price > 0 ? '+' : '' }}{{ participantFlag.flagRange.price }},- Kč
                                    </strong>
                                </div>
                            {% endif %}
                            {% if participantFlag.textValue|default|length > 0 %}
                                <div class="badge badge-warn small">
                                    {{ participantFlag.textValue }}
                                </div>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            {% endfor %}
        </div>
    </td>
    <td style="border:1px solid grey; padding:.3em .6em; text-align:right;color:{{ participant.remainingPrice|default(0) == 0 ? 'green' : 'red' }}">
        <div class="block">
            <strong>💰 {{ participant.paidPrice|default(0) }},-&nbsp;Kč</strong>
        </div>
        <div class="block">
            z&nbsp;{{ participant.price|default(0) }},-&nbsp;Kč
        </div>
        <div class="block small">
            zbývá {{ participant.remainingPrice|default(0) }},-&nbsp;Kč
            {% if participant.remainingPrice|default(0) > 0 %}
                <strong style="color: orange;">★</strong>
            {% elseif participant.remainingPrice|default(0) < 0 %}
                <strong style="color: red;">⚠</strong>
            {% else %}
                <strong style="color: green;">✔</strong>
            {% endif %}
        </div>
        {% if participant.price != 0 %}
            {% set paidPercentage = participant.paidPricePercentage * 100 %}
            {% set paidColor = participant.remainingPrice > 0 ? 'danger' : 'success' %}
            {% set paidColor = participant.remainingDeposit > 0 ? paidColor : 'warning' %}
            <div class="progress">
                <div class="progress-bar progress-bar-striped bg-{{ paidColor }}" role="progressbar" style="width: {{ paidPercentage }}%"
                     aria-valuenow="{{ paidPercentage }}" aria-valuemin="0" aria-valuemax="100">
                    {{ paidPercentage }} %
                </div>
            </div>
        {% endif %}
    </td>
</tr>
</tbody>

